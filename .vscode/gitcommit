#!/bin/bash

# Linux版本的gitcommit脚本
# 用法: gitcommit <输出文件> <正确答案文件> <源文件> <源文件名>

# 参数检查
if [ $# -ne 4 ]; then
    echo "用法: gitcommit <输出文件> <正确答案文件> <源文件> <源文件名>"
    exit 1
fi

OUTPUT_FILE=$1
CORRECT_FILE=$2
SOURCE_FILE=$3
SOURCE_BASENAME=$4

# 检查文件是否存在
if [ ! -f "$OUTPUT_FILE" ]; then
    echo "错误: 输出文件不存在: $OUTPUT_FILE"
    exit 1
fi

if [ ! -f "$CORRECT_FILE" ]; then
    echo "错误: 正确答案文件不存在: $CORRECT_FILE"
    exit 1
fi

# 比较输出和正确答案
diff -q "$OUTPUT_FILE" "$CORRECT_FILE" > /dev/null
RESULT=$?

# 输出结果
if [ $RESULT -eq 0 ]; then
    echo "测试通过: 输出与正确答案匹配!"
    
    # Git提交
    if [ -d ".git" ]; then
        git add "$SOURCE_FILE"
        git commit -m "解决: $SOURCE_BASENAME"
        echo "已提交到Git"
    else
        echo "注意: 当前目录不是Git仓库，跳过提交"
    fi
else
    echo "测试失败: 输出与正确答案不匹配"
    echo "查看差异:"
    diff "$OUTPUT_FILE" "$CORRECT_FILE"
fi

exit $RESULT